{"version":3,"file":"13c832ea.js","mappings":";AAgDA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAjDA;;;;;;;;AAAA;;ACsBA;AACA;AACA;;AA1BA;;ACmGA;AACA;AACA;AACA;AACA;;AAKA;;AAGA;AACA;AACA;;AAEA;AACA;;;AAMA;;AAGA;AACA;AACA;;AAKA;;;AAGA;AACA;;;;ACtBA;;;;AAMA;;;AAIA;;AAGA;AAGA;;AAEA;;;;;;AAMA;AAGA;;;AAGA;;;;;;AAMA;;;;;;;AASA;AAGA;;AAEA;;;AAKA;AAGA;;;;;;;AAOA;;;;;AAOA;;;;;;AAMA;;AAIA;;AAIA;;;;;;AAMA;;AAIA;;AAGA;;;;;;AAMA;AAGA;;;AAIA;;AAGA;;AAGA;;AAEA;;AAGA;AACA;;;AAGA;;;AAMA;AACA;AACA;;AAEA;;AAGA;AACA;;AAaA;;AAGA;AACA;;AAEA;;;;AAMA;AAEA;;AAGA;AAGA;AACA;;;AAIA;;AAIA;AAGA;AACA;;AAEA;AAEA;;;;AAKA;AAGA;;;AAGA;;AAGA;;AAIA;;;AAGA;;;;AAMA;;;AAGA;AAEA;;AAIA;;AAIA;;;AAIA;;;;AAMA;;;AAGA;AAEA;;AAGA;;AAIA;;;AAGA;;;;AAMA;;;;AAIA;;AAIA;;;AAIA;;;;;;;AASA;AAEA;;;AAOA;AAGA;;AAGA;;;AAKA;;;AAGA;AAEA;;;AAKA;AAGA;;AAGA;;;AAKA;;;AAGA;AAEA;;AAGA;;;;;;;AAUA;;AAIA;;;;;;;AASA;;AAGA;;;AAIA;;;;AAKA;AACA;AACA;;AAEA;;AAGA;AACA;;AAYA;;AAGA;AACA;;AAIA;AACA;;AAEA;AAEA;;AAGA;AAGA;AACA;;AAEA;AAEA;;AAGA;;AAIA;AACA;;;AAGA;AACA;;AAIA;AACA;;AAGA;;;AAKA;;;AAIA;AACA;;;AAKA;;;AAIA;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAhfA","sources":["webpack://home-assistant-frontend/./src/components/ha-button-menu.ts","webpack://home-assistant-frontend/./src/components/ha-icon-button-arrow-next.ts","webpack://home-assistant-frontend/./src/panels/lovelace/ha-panel-lovelace.ts","webpack://home-assistant-frontend/./src/panels/lovelace/hui-root.ts"],"sourcesContent":["import type { Button } from \"@material/mwc-button\";\nimport \"@material/mwc-menu\";\nimport type { Corner, Menu, MenuCorner } from \"@material/mwc-menu\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, query } from \"lit/decorators\";\nimport { FOCUS_TARGET } from \"../dialogs/make-dialog-manager\";\nimport type { HaIconButton } from \"./ha-icon-button\";\n\n@customElement(\"ha-button-menu\")\nexport class HaButtonMenu extends LitElement {\n  protected readonly [FOCUS_TARGET];\n\n  @property() public corner: Corner = \"TOP_START\";\n\n  @property() public menuCorner: MenuCorner = \"START\";\n\n  @property({ type: Number }) public x: number | null = null;\n\n  @property({ type: Number }) public y: number | null = null;\n\n  @property({ type: Boolean }) public multi = false;\n\n  @property({ type: Boolean }) public activatable = false;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public fixed = false;\n\n  @query(\"mwc-menu\", true) private _menu?: Menu;\n\n  public get items() {\n    return this._menu?.items;\n  }\n\n  public get selected() {\n    return this._menu?.selected;\n  }\n\n  public override focus() {\n    if (this._menu?.open) {\n      this._menu.focusItemAtIndex(0);\n    } else {\n      this._triggerButton?.focus();\n    }\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <div @click=${this._handleClick}>\n        <slot name=\"trigger\" @slotchange=${this._setTriggerAria}></slot>\n      </div>\n      <mwc-menu\n        .corner=${this.corner}\n        .menuCorner=${this.menuCorner}\n        .fixed=${this.fixed}\n        .multi=${this.multi}\n        .activatable=${this.activatable}\n        .y=${this.y}\n        .x=${this.x}\n      >\n        <slot></slot>\n      </mwc-menu>\n    `;\n  }\n\n  protected firstUpdated(changedProps): void {\n    super.firstUpdated(changedProps);\n\n    if (document.dir === \"rtl\") {\n      this.updateComplete.then(() => {\n        this.querySelectorAll(\"mwc-list-item\").forEach((item) => {\n          const style = document.createElement(\"style\");\n          style.innerHTML =\n            \"span.material-icons:first-of-type { margin-left: var(--mdc-list-item-graphic-margin, 32px) !important; margin-right: 0px !important;}\";\n          item!.shadowRoot!.appendChild(style);\n        });\n      });\n    }\n  }\n\n  private _handleClick(): void {\n    if (this.disabled) {\n      return;\n    }\n    this._menu!.anchor = this;\n    this._menu!.show();\n  }\n\n  private get _triggerButton() {\n    return this.querySelector(\n      'ha-icon-button[slot=\"trigger\"], mwc-button[slot=\"trigger\"]'\n    ) as HaIconButton | Button | null;\n  }\n\n  private _setTriggerAria() {\n    if (this._triggerButton) {\n      this._triggerButton.ariaHasPopup = \"menu\";\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: inline-block;\n        position: relative;\n      }\n      ::slotted([disabled]) {\n        color: var(--disabled-text-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-button-menu\": HaButtonMenu;\n  }\n}\n","import { mdiArrowLeft, mdiArrowRight } from \"@mdi/js\";\nimport { html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { HomeAssistant } from \"../types\";\nimport \"./ha-icon-button\";\n\n@customElement(\"ha-icon-button-arrow-next\")\nexport class HaIconButtonArrowNext extends LitElement {\n  @property({ attribute: false }) public hass?: HomeAssistant;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property() public label?: string;\n\n  @state() private _icon = mdiArrowRight;\n\n  public connectedCallback() {\n    super.connectedCallback();\n\n    // wait to check for direction since otherwise direction is wrong even though top level is RTL\n    setTimeout(() => {\n      this._icon =\n        window.getComputedStyle(this).direction === \"ltr\"\n          ? mdiArrowRight\n          : mdiArrowLeft;\n    }, 100);\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-icon-button\n        .disabled=${this.disabled}\n        .label=${this.label || this.hass?.localize(\"ui.common.next\") || \"Next\"}\n        .path=${this._icon}\n      ></ha-icon-button>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-icon-button-arrow-next\": HaIconButtonArrowNext;\n  }\n}\n","import \"@material/mwc-button\";\nimport deepFreeze from \"deep-freeze\";\nimport { html, LitElement, TemplateResult } from \"lit\";\nimport { property, state } from \"lit/decorators\";\nimport { constructUrlCurrentPath } from \"../../common/url/construct-url\";\nimport {\n  addSearchParam,\n  removeSearchParam,\n} from \"../../common/url/search-params\";\nimport { domainToName } from \"../../data/integration\";\nimport {\n  deleteConfig,\n  fetchConfig,\n  fetchResources,\n  LovelaceConfig,\n  saveConfig,\n  subscribeLovelaceUpdates,\n  WindowWithLovelaceProm,\n} from \"../../data/lovelace\";\nimport \"../../layouts/hass-error-screen\";\nimport \"../../layouts/hass-loading-screen\";\nimport { HomeAssistant, PanelInfo, Route } from \"../../types\";\nimport { showToast } from \"../../util/toast\";\nimport { loadLovelaceResources } from \"./common/load-resources\";\nimport { showSaveDialog } from \"./editor/show-save-config-dialog\";\nimport \"./hui-root\";\nimport { generateLovelaceDashboardStrategy } from \"./strategies/get-strategy\";\nimport { Lovelace } from \"./types\";\n\n(window as any).loadCardHelpers = () => import(\"./custom-card-helpers\");\n\nconst DEFAULT_STRATEGY = \"original-states\";\n\ninterface LovelacePanelConfig {\n  mode: \"yaml\" | \"storage\";\n}\n\nlet editorLoaded = false;\nlet resourcesLoaded = false;\n\nclass LovelacePanel extends LitElement {\n  @property() public panel?: PanelInfo<LovelacePanelConfig>;\n\n  @property({ attribute: false }) public hass?: HomeAssistant;\n\n  @property() public narrow?: boolean;\n\n  @property() public route?: Route;\n\n  @property()\n  private _panelState?: \"loading\" | \"loaded\" | \"error\" | \"yaml-editor\" =\n    \"loading\";\n\n  @state() private _errorMsg?: string;\n\n  @state() private lovelace?: Lovelace;\n\n  private _ignoreNextUpdateEvent = false;\n\n  private _fetchConfigOnConnect = false;\n\n  private _unsubUpdates?;\n\n  constructor() {\n    super();\n    this._closeEditor = this._closeEditor.bind(this);\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    if (\n      this.lovelace &&\n      this.hass &&\n      this.lovelace.locale !== this.hass.locale\n    ) {\n      // language has been changed, rebuild UI\n      this._setLovelaceConfig(\n        this.lovelace.config,\n        this.lovelace.rawConfig,\n        this.lovelace.mode\n      );\n    } else if (this.lovelace && this.lovelace.mode === \"generated\") {\n      // When lovelace is generated, we re-generate each time a user goes\n      // to the states panel to make sure new entities are shown.\n      this._panelState = \"loading\";\n      this._regenerateConfig();\n    } else if (this._fetchConfigOnConnect) {\n      // Config was changed when we were not at the lovelace panel\n      this._fetchConfig(false);\n    }\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    // On the main dashboard we want to stay subscribed as that one is cached.\n    if (this.urlPath !== null && this._unsubUpdates) {\n      this._unsubUpdates();\n    }\n  }\n\n  protected render(): TemplateResult | void {\n    const panelState = this._panelState!;\n\n    if (panelState === \"loaded\") {\n      return html`\n        <hui-root\n          .hass=${this.hass}\n          .lovelace=${this.lovelace}\n          .route=${this.route}\n          .narrow=${this.narrow}\n          @config-refresh=${this._forceFetchConfig}\n        ></hui-root>\n      `;\n    }\n\n    if (panelState === \"error\") {\n      return html`\n        <hass-error-screen\n          .hass=${this.hass}\n          title=${domainToName(this.hass!.localize, \"lovelace\")}\n          .error=${this._errorMsg}\n        >\n          <mwc-button raised @click=${this._forceFetchConfig}>\n            ${this.hass!.localize(\"ui.panel.lovelace.reload_lovelace\")}\n          </mwc-button>\n        </hass-error-screen>\n      `;\n    }\n\n    if (panelState === \"yaml-editor\") {\n      return html`\n        <hui-editor\n          .hass=${this.hass}\n          .lovelace=${this.lovelace}\n          .closeEditor=${this._closeEditor}\n        ></hui-editor>\n      `;\n    }\n\n    return html`\n      <hass-loading-screen\n        rootnav\n        .hass=${this.hass}\n        .narrow=${this.narrow}\n      ></hass-loading-screen>\n    `;\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n\n    this._fetchConfig(false);\n    if (!this._unsubUpdates) {\n      this._subscribeUpdates();\n    }\n    // reload lovelace on reconnect so we are sure we have the latest config\n    window.addEventListener(\"connection-status\", (ev) => {\n      if (ev.detail === \"connected\") {\n        this._fetchConfig(false);\n      }\n    });\n  }\n\n  private async _regenerateConfig() {\n    const conf = await generateLovelaceDashboardStrategy(\n      {\n        hass: this.hass!,\n        narrow: this.narrow,\n      },\n      DEFAULT_STRATEGY\n    );\n    this._setLovelaceConfig(conf, undefined, \"generated\");\n    this._panelState = \"loaded\";\n  }\n\n  private async _subscribeUpdates() {\n    this._unsubUpdates = await subscribeLovelaceUpdates(\n      this.hass!.connection,\n      this.urlPath,\n      () => this._lovelaceChanged()\n    );\n  }\n\n  private _closeEditor() {\n    this._panelState = \"loaded\";\n  }\n\n  private _lovelaceChanged() {\n    if (this._ignoreNextUpdateEvent) {\n      this._ignoreNextUpdateEvent = false;\n      return;\n    }\n    if (!this.isConnected) {\n      // We can't fire events from an element that is not connected\n      // Make sure we fetch the config as soon as the user goes back to Lovelace\n      this._fetchConfigOnConnect = true;\n      return;\n    }\n    showToast(this, {\n      message: this.hass!.localize(\"ui.panel.lovelace.changed_toast.message\"),\n      action: {\n        action: () => this._fetchConfig(false),\n        text: this.hass!.localize(\"ui.common.refresh\"),\n      },\n      duration: 0,\n      dismissable: false,\n    });\n  }\n\n  public get urlPath() {\n    return this.panel!.url_path === \"lovelace\" ? null : this.panel!.url_path;\n  }\n\n  private _forceFetchConfig() {\n    this._fetchConfig(true);\n  }\n\n  private async _fetchConfig(forceDiskRefresh: boolean) {\n    let conf: LovelaceConfig;\n    let rawConf: LovelaceConfig | undefined;\n    let confMode: Lovelace[\"mode\"] = this.panel!.config.mode;\n    let confProm: Promise<LovelaceConfig> | undefined;\n    const llWindow = window as WindowWithLovelaceProm;\n\n    // On first load, we speed up loading page by having LL promise ready\n    if (llWindow.llConfProm) {\n      confProm = llWindow.llConfProm;\n      llWindow.llConfProm = undefined;\n    }\n    if (!resourcesLoaded) {\n      resourcesLoaded = true;\n      (llWindow.llConfProm || fetchResources(this.hass!.connection)).then(\n        (resources) =>\n          loadLovelaceResources(resources, this.hass!.auth.data.hassUrl)\n      );\n    }\n\n    if (this.urlPath !== null || !confProm) {\n      // Refreshing a YAML config can trigger an update event. We will ignore\n      // all update events while fetching the config and for 2 seconds after the config is back.\n      // We ignore because we already have the latest config.\n      if (this.lovelace && this.lovelace.mode === \"yaml\") {\n        this._ignoreNextUpdateEvent = true;\n      }\n\n      confProm = fetchConfig(\n        this.hass!.connection,\n        this.urlPath,\n        forceDiskRefresh\n      );\n    }\n\n    try {\n      rawConf = await confProm!;\n\n      // If strategy defined, apply it here.\n      if (rawConf.strategy) {\n        conf = await generateLovelaceDashboardStrategy({\n          config: rawConf,\n          hass: this.hass!,\n          narrow: this.narrow,\n        });\n      } else {\n        conf = rawConf;\n      }\n    } catch (err: any) {\n      if (err.code !== \"config_not_found\") {\n        // eslint-disable-next-line\n        console.log(err);\n        this._panelState = \"error\";\n        this._errorMsg = err.message;\n        return;\n      }\n      conf = await generateLovelaceDashboardStrategy(\n        {\n          hass: this.hass!,\n          narrow: this.narrow,\n        },\n        DEFAULT_STRATEGY\n      );\n      confMode = \"generated\";\n    } finally {\n      // Ignore updates for another 2 seconds.\n      if (this.lovelace && this.lovelace.mode === \"yaml\") {\n        setTimeout(() => {\n          this._ignoreNextUpdateEvent = false;\n        }, 2000);\n      }\n    }\n\n    this._panelState =\n      this._panelState === \"yaml-editor\" ? this._panelState : \"loaded\";\n    this._setLovelaceConfig(conf, rawConf, confMode);\n  }\n\n  private _checkLovelaceConfig(config: LovelaceConfig) {\n    // Somehow there can be badges with value null, we remove those\n    let checkedConfig = !Object.isFrozen(config) ? config : undefined;\n    config.views.forEach((view, index) => {\n      if (view.badges && !view.badges.every(Boolean)) {\n        checkedConfig = checkedConfig || {\n          ...config,\n          views: [...config.views],\n        };\n        checkedConfig.views[index] = { ...view };\n        checkedConfig.views[index].badges = view.badges.filter(Boolean);\n      }\n    });\n    return checkedConfig ? deepFreeze(checkedConfig) : config;\n  }\n\n  private _setLovelaceConfig(\n    config: LovelaceConfig,\n    rawConfig: LovelaceConfig | undefined,\n    mode: Lovelace[\"mode\"]\n  ) {\n    config = this._checkLovelaceConfig(config);\n    const urlPath = this.urlPath;\n    this.lovelace = {\n      config,\n      rawConfig,\n      mode,\n      urlPath: this.urlPath,\n      editMode: this.lovelace ? this.lovelace.editMode : false,\n      locale: this.hass!.locale,\n      enableFullEditMode: () => {\n        if (!editorLoaded) {\n          editorLoaded = true;\n          import(\"./hui-editor\");\n        }\n        this._panelState = \"yaml-editor\";\n      },\n      setEditMode: (editMode: boolean) => {\n        // If we use a strategy for dashboard, we cannot show the edit UI\n        // So go straight to the YAML editor\n        if (\n          this.lovelace!.rawConfig &&\n          this.lovelace!.rawConfig !== this.lovelace!.config\n        ) {\n          this.lovelace!.enableFullEditMode();\n          return;\n        }\n\n        if (!editMode || this.lovelace!.mode !== \"generated\") {\n          this._updateLovelace({ editMode });\n          return;\n        }\n\n        showSaveDialog(this, {\n          lovelace: this.lovelace!,\n          mode: this.panel!.config.mode,\n          narrow: this.narrow!,\n        });\n      },\n      saveConfig: async (newConfig: LovelaceConfig): Promise<void> => {\n        const {\n          config: previousConfig,\n          rawConfig: previousRawConfig,\n          mode: previousMode,\n        } = this.lovelace!;\n        newConfig = this._checkLovelaceConfig(newConfig);\n        let conf: LovelaceConfig;\n        // If strategy defined, apply it here.\n        if (newConfig.strategy) {\n          conf = await generateLovelaceDashboardStrategy({\n            config: newConfig,\n            hass: this.hass!,\n            narrow: this.narrow,\n          });\n        } else {\n          conf = newConfig;\n        }\n        try {\n          // Optimistic update\n          this._updateLovelace({\n            config: conf,\n            rawConfig: newConfig,\n            mode: \"storage\",\n          });\n          this._ignoreNextUpdateEvent = true;\n          await saveConfig(this.hass!, urlPath, newConfig);\n        } catch (err: any) {\n          // eslint-disable-next-line\n          console.error(err);\n          // Rollback the optimistic update\n          this._updateLovelace({\n            config: previousConfig,\n            rawConfig: previousRawConfig,\n            mode: previousMode,\n          });\n          throw err;\n        }\n      },\n      deleteConfig: async (): Promise<void> => {\n        const {\n          config: previousConfig,\n          rawConfig: previousRawConfig,\n          mode: previousMode,\n        } = this.lovelace!;\n        try {\n          // Optimistic update\n          const generatedConf = await generateLovelaceDashboardStrategy(\n            {\n              hass: this.hass!,\n              narrow: this.narrow,\n            },\n            DEFAULT_STRATEGY\n          );\n          this._updateLovelace({\n            config: generatedConf,\n            rawConfig: undefined,\n            mode: \"generated\",\n            editMode: false,\n          });\n          this._ignoreNextUpdateEvent = true;\n          await deleteConfig(this.hass!, urlPath);\n        } catch (err: any) {\n          // eslint-disable-next-line\n          console.error(err);\n          // Rollback the optimistic update\n          this._updateLovelace({\n            config: previousConfig,\n            rawConfig: previousRawConfig,\n            mode: previousMode,\n          });\n          throw err;\n        }\n      },\n    };\n  }\n\n  private _updateLovelace(props: Partial<Lovelace>) {\n    this.lovelace = {\n      ...this.lovelace!,\n      ...props,\n    };\n\n    if (\"editMode\" in props) {\n      window.history.replaceState(\n        null,\n        \"\",\n        constructUrlCurrentPath(\n          props.editMode\n            ? addSearchParam({ edit: \"1\" })\n            : removeSearchParam(\"edit\")\n        )\n      );\n    }\n  }\n}\n\ncustomElements.define(\"ha-panel-lovelace\", LovelacePanel);\n","import \"@material/mwc-button\";\nimport \"@material/mwc-list/mwc-list-item\";\nimport type { RequestSelectedDetail } from \"@material/mwc-list/mwc-list-item\";\nimport {\n  mdiCodeBraces,\n  mdiDotsVertical,\n  mdiFileMultiple,\n  mdiFormatListBulletedTriangle,\n  mdiHelp,\n  mdiHelpCircle,\n  mdiMagnify,\n  mdiMicrophone,\n  mdiPencil,\n  mdiPlus,\n  mdiRefresh,\n  mdiShape,\n  mdiViewDashboard,\n} from \"@mdi/js\";\nimport \"@polymer/app-layout/app-header/app-header\";\nimport \"@polymer/app-layout/app-scroll-effects/effects/waterfall\";\nimport \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport \"@polymer/paper-tabs/paper-tab\";\nimport \"@polymer/paper-tabs/paper-tabs\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { property, query, state } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { ifDefined } from \"lit/directives/if-defined\";\nimport memoizeOne from \"memoize-one\";\nimport { isComponentLoaded } from \"../../common/config/is_component_loaded\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport scrollToTarget from \"../../common/dom/scroll-to-target\";\nimport { shouldHandleRequestSelectedEvent } from \"../../common/mwc/handle-request-selected-event\";\nimport { navigate } from \"../../common/navigate\";\nimport {\n  addSearchParam,\n  extractSearchParam,\n} from \"../../common/url/search-params\";\nimport { computeRTLDirection } from \"../../common/util/compute_rtl\";\nimport { debounce } from \"../../common/util/debounce\";\nimport { afterNextRender } from \"../../common/util/render-status\";\nimport \"../../components/ha-button-menu\";\nimport \"../../components/ha-icon\";\nimport \"../../components/ha-icon-button\";\nimport \"../../components/ha-icon-button-arrow-next\";\nimport \"../../components/ha-icon-button-arrow-prev\";\nimport \"../../components/ha-menu-button\";\nimport \"../../components/ha-svg-icon\";\nimport \"../../components/ha-tabs\";\nimport type {\n  LovelaceConfig,\n  LovelacePanelConfig,\n  LovelaceViewConfig,\n} from \"../../data/lovelace\";\nimport {\n  showAlertDialog,\n  showConfirmationDialog,\n} from \"../../dialogs/generic/show-dialog-box\";\nimport { showQuickBar } from \"../../dialogs/quick-bar/show-dialog-quick-bar\";\nimport { showVoiceCommandDialog } from \"../../dialogs/voice-command-dialog/show-ha-voice-command-dialog\";\nimport \"../../layouts/ha-app-layout\";\nimport type { haAppLayout } from \"../../layouts/ha-app-layout\";\nimport { haStyle } from \"../../resources/styles\";\nimport type { HomeAssistant } from \"../../types\";\nimport { documentationUrl } from \"../../util/documentation-url\";\nimport { swapView } from \"./editor/config-util\";\nimport { showEditLovelaceDialog } from \"./editor/lovelace-editor/show-edit-lovelace-dialog\";\nimport { showEditViewDialog } from \"./editor/view-editor/show-edit-view-dialog\";\nimport type { Lovelace } from \"./types\";\nimport \"./views/hui-view\";\nimport type { HUIView } from \"./views/hui-view\";\n\nclass HUIRoot extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public lovelace?: Lovelace;\n\n  @property({ type: Boolean }) public narrow = false;\n\n  @property({ attribute: false }) public route?: {\n    path: string;\n    prefix: string;\n  };\n\n  @state() private _curView?: number | \"hass-unused-entities\";\n\n  @query(\"ha-app-layout\", true) private _appLayout!: haAppLayout;\n\n  private _viewCache?: { [viewId: string]: HUIView };\n\n  private _debouncedConfigChanged: () => void;\n\n  private _conversation = memoizeOne((_components) =>\n    isComponentLoaded(this.hass, \"conversation\")\n  );\n\n  constructor() {\n    super();\n    // The view can trigger a re-render when it knows that certain\n    // web components have been loaded.\n    this._debouncedConfigChanged = debounce(\n      () => this._selectView(this._curView, true),\n      100,\n      false\n    );\n  }\n\n  protected render(): TemplateResult {\n    const views = this.lovelace?.config.views ?? [];\n\n    const curViewConfig =\n      typeof this._curView === \"number\" ? views[this._curView] : undefined;\n\n    return html`\n      <ha-app-layout\n        class=${classMap({\n          \"edit-mode\": this._editMode,\n        })}\n        id=\"layout\"\n      >\n        <app-header slot=\"header\" effects=\"waterfall\" fixed condenses>\n          ${this._editMode\n            ? html`\n                <app-toolbar class=\"edit-mode\">\n                  <div main-title>\n                    ${this.config.title ||\n                    this.hass!.localize(\"ui.panel.lovelace.editor.header\")}\n                    <ha-icon-button\n                      .label=${this.hass!.localize(\n                        \"ui.panel.lovelace.editor.edit_lovelace.edit_title\"\n                      )}\n                      .path=${mdiPencil}\n                      class=\"edit-icon\"\n                      @click=${this._editLovelace}\n                    ></ha-icon-button>\n                  </div>\n                  <mwc-button\n                    outlined\n                    class=\"exit-edit-mode\"\n                    .label=${this.hass!.localize(\n                      \"ui.panel.lovelace.menu.exit_edit_mode\"\n                    )}\n                    @click=${this._editModeDisable}\n                  ></mwc-button>\n                  <a\n                    href=${documentationUrl(this.hass, \"/lovelace/\")}\n                    rel=\"noreferrer\"\n                    class=\"menu-link\"\n                    target=\"_blank\"\n                  >\n                    <ha-icon-button\n                      .label=${this.hass!.localize(\n                        \"ui.panel.lovelace.menu.help\"\n                      )}\n                      .path=${mdiHelpCircle}\n                    ></ha-icon-button>\n                  </a>\n                  <ha-button-menu corner=\"BOTTOM_START\">\n                    <ha-icon-button\n                      slot=\"trigger\"\n                      .label=${this.hass!.localize(\n                        \"ui.panel.lovelace.editor.menu.open\"\n                      )}\n                      .path=${mdiDotsVertical}\n                    ></ha-icon-button>\n                    ${__DEMO__ /* No unused entities available in the demo */\n                      ? \"\"\n                      : html`\n                          <mwc-list-item\n                            graphic=\"icon\"\n                            aria-label=${this.hass!.localize(\n                              \"ui.panel.lovelace.unused_entities.title\"\n                            )}\n                            @request-selected=${this._handleUnusedEntities}\n                          >\n                            <ha-svg-icon\n                              slot=\"graphic\"\n                              .path=${mdiFormatListBulletedTriangle}\n                            >\n                            </ha-svg-icon>\n                            ${this.hass!.localize(\n                              \"ui.panel.lovelace.unused_entities.title\"\n                            )}\n                          </mwc-list-item>\n                        `}\n                    <mwc-list-item\n                      graphic=\"icon\"\n                      @request-selected=${this._handleRawEditor}\n                    >\n                      <ha-svg-icon\n                        slot=\"graphic\"\n                        .path=${mdiCodeBraces}\n                      ></ha-svg-icon>\n                      ${this.hass!.localize(\n                        \"ui.panel.lovelace.editor.menu.raw_editor\"\n                      )}\n                    </mwc-list-item>\n                    ${__DEMO__ /* No config available in the demo */\n                      ? \"\"\n                      : html`<mwc-list-item\n                            graphic=\"icon\"\n                            @request-selected=${this._handleManageDashboards}\n                          >\n                            <ha-svg-icon\n                              slot=\"graphic\"\n                              .path=${mdiViewDashboard}\n                            ></ha-svg-icon>\n                            ${this.hass!.localize(\n                              \"ui.panel.lovelace.editor.menu.manage_dashboards\"\n                            )}\n                          </mwc-list-item>\n                          ${this.hass.userData?.showAdvanced\n                            ? html`<mwc-list-item\n                                graphic=\"icon\"\n                                @request-selected=${this._handleManageResources}\n                              >\n                                <ha-svg-icon\n                                  slot=\"graphic\"\n                                  .path=${mdiFileMultiple}\n                                ></ha-svg-icon>\n                                ${this.hass!.localize(\n                                  \"ui.panel.lovelace.editor.menu.manage_resources\"\n                                )}\n                              </mwc-list-item>`\n                            : \"\"} `}\n                  </ha-button-menu>\n                </app-toolbar>\n              `\n            : html`\n                <app-toolbar>\n                  ${curViewConfig?.subview\n                    ? html`\n                        <ha-icon-button-arrow-prev\n                          @click=${this._goBack}\n                        ></ha-icon-button-arrow-prev>\n                      `\n                    : html`\n                        <ha-menu-button\n                          .hass=${this.hass}\n                          .narrow=${this.narrow}\n                        ></ha-menu-button>\n                      `}\n                  ${curViewConfig?.subview\n                    ? html`<div main-title>${curViewConfig.title}</div>`\n                    : views.filter((view) => !view.subview).length > 1\n                    ? html`\n                        <ha-tabs\n                          scrollable\n                          .selected=${this._curView}\n                          @iron-activate=${this._handleViewSelected}\n                          dir=${computeRTLDirection(this.hass!)}\n                        >\n                          ${views.map(\n                            (view) => html`\n                              <paper-tab\n                                aria-label=${ifDefined(view.title)}\n                                class=${classMap({\n                                  \"hide-tab\": Boolean(\n                                    view.subview ||\n                                      (view.visible !== undefined &&\n                                        ((Array.isArray(view.visible) &&\n                                          !view.visible.some(\n                                            (e) =>\n                                              e.user === this.hass!.user!.id\n                                          )) ||\n                                          view.visible === false))\n                                  ),\n                                })}\n                              >\n                                ${view.icon\n                                  ? html`\n                                      <ha-icon\n                                        title=${ifDefined(view.title)}\n                                        .icon=${view.icon}\n                                      ></ha-icon>\n                                    `\n                                  : view.title || \"Unnamed view\"}\n                              </paper-tab>\n                            `\n                          )}\n                        </ha-tabs>\n                      `\n                    : html`<div main-title>${this.config.title}</div>`}\n                  ${!this.narrow\n                    ? html`\n                        <ha-icon-button\n                          .label=${this.hass!.localize(\n                            \"ui.panel.lovelace.menu.search\"\n                          )}\n                          .path=${mdiMagnify}\n                          @click=${this._showQuickBar}\n                        ></ha-icon-button>\n                      `\n                    : \"\"}\n                  ${!this.narrow &&\n                  this._conversation(this.hass.config.components)\n                    ? html`\n                        <ha-icon-button\n                          .label=${this.hass!.localize(\n                            \"ui.panel.lovelace.menu.start_conversation\"\n                          )}\n                          .path=${mdiMicrophone}\n                          @click=${this._showVoiceCommandDialog}\n                        ></ha-icon-button>\n                      `\n                    : \"\"}\n                  ${this._showButtonMenu\n                    ? html`\n                        <ha-button-menu corner=\"BOTTOM_START\">\n                          <ha-icon-button\n                            slot=\"trigger\"\n                            .label=${this.hass!.localize(\n                              \"ui.panel.lovelace.editor.menu.open\"\n                            )}\n                            .path=${mdiDotsVertical}\n                          ></ha-icon-button>\n\n                          ${this.narrow\n                            ? html`\n                                <mwc-list-item\n                                  .label=${this.hass!.localize(\n                                    \"ui.panel.lovelace.menu.search\"\n                                  )}\n                                  graphic=\"icon\"\n                                  @request-selected=${this._showQuickBar}\n                                >\n                                  <span\n                                    >${this.hass!.localize(\n                                      \"ui.panel.lovelace.menu.search\"\n                                    )}</span\n                                  >\n                                  <ha-svg-icon\n                                    slot=\"graphic\"\n                                    .path=${mdiMagnify}\n                                  ></ha-svg-icon>\n                                </mwc-list-item>\n                              `\n                            : \"\"}\n                          ${this.narrow &&\n                          this._conversation(this.hass.config.components)\n                            ? html`\n                                <mwc-list-item\n                                  .label=${this.hass!.localize(\n                                    \"ui.panel.lovelace.menu.start_conversation\"\n                                  )}\n                                  graphic=\"icon\"\n                                  @request-selected=${this\n                                    ._showVoiceCommandDialog}\n                                >\n                                  <span\n                                    >${this.hass!.localize(\n                                      \"ui.panel.lovelace.menu.start_conversation\"\n                                    )}</span\n                                  >\n                                  <ha-svg-icon\n                                    slot=\"graphic\"\n                                    .path=${mdiMicrophone}\n                                  ></ha-svg-icon>\n                                </mwc-list-item>\n                              `\n                            : \"\"}\n                          ${this._yamlMode\n                            ? html`\n                                <mwc-list-item\n                                  aria-label=${this.hass!.localize(\n                                    \"ui.common.refresh\"\n                                  )}\n                                  graphic=\"icon\"\n                                  @request-selected=${this._handleRefresh}\n                                >\n                                  <span\n                                    >${this.hass!.localize(\n                                      \"ui.common.refresh\"\n                                    )}</span\n                                  >\n                                  <ha-svg-icon\n                                    slot=\"graphic\"\n                                    .path=${mdiRefresh}\n                                  ></ha-svg-icon>\n                                </mwc-list-item>\n                                <mwc-list-item\n                                  aria-label=${this.hass!.localize(\n                                    \"ui.panel.lovelace.unused_entities.title\"\n                                  )}\n                                  graphic=\"icon\"\n                                  @request-selected=${this\n                                    ._handleUnusedEntities}\n                                >\n                                  <span\n                                    >${this.hass!.localize(\n                                      \"ui.panel.lovelace.unused_entities.title\"\n                                    )}</span\n                                  >\n                                  <ha-svg-icon\n                                    slot=\"graphic\"\n                                    .path=${mdiShape}\n                                  ></ha-svg-icon>\n                                </mwc-list-item>\n                              `\n                            : \"\"}\n                          ${(\n                            this.hass.panels.lovelace\n                              ?.config as LovelacePanelConfig\n                          )?.mode === \"yaml\"\n                            ? html`\n                                <mwc-list-item\n                                  graphic=\"icon\"\n                                  aria-label=${this.hass!.localize(\n                                    \"ui.panel.lovelace.menu.reload_resources\"\n                                  )}\n                                  @request-selected=${this\n                                    ._handleReloadResources}\n                                >\n                                  ${this.hass!.localize(\n                                    \"ui.panel.lovelace.menu.reload_resources\"\n                                  )}\n                                  <ha-svg-icon\n                                    slot=\"graphic\"\n                                    .path=${mdiRefresh}\n                                  ></ha-svg-icon>\n                                </mwc-list-item>\n                              `\n                            : \"\"}\n                          ${this.hass!.user?.is_admin &&\n                          !this.hass!.config.safe_mode\n                            ? html`\n                                <mwc-list-item\n                                  graphic=\"icon\"\n                                  aria-label=${this.hass!.localize(\n                                    \"ui.panel.lovelace.menu.configure_ui\"\n                                  )}\n                                  @request-selected=${this\n                                    ._handleEnableEditMode}\n                                >\n                                  ${this.hass!.localize(\n                                    \"ui.panel.lovelace.menu.configure_ui\"\n                                  )}\n                                  <ha-svg-icon\n                                    slot=\"graphic\"\n                                    .path=${mdiPencil}\n                                  ></ha-svg-icon>\n                                </mwc-list-item>\n                              `\n                            : \"\"}\n                          ${this._editMode\n                            ? html`\n                                <a\n                                  href=${documentationUrl(\n                                    this.hass,\n                                    \"/lovelace/\"\n                                  )}\n                                  rel=\"noreferrer\"\n                                  class=\"menu-link\"\n                                  target=\"_blank\"\n                                >\n                                  <mwc-list-item\n                                    graphic=\"icon\"\n                                    aria-label=${this.hass!.localize(\n                                      \"ui.panel.lovelace.menu.help\"\n                                    )}\n                                  >\n                                    ${this.hass!.localize(\n                                      \"ui.panel.lovelace.menu.help\"\n                                    )}\n                                    <ha-svg-icon\n                                      slot=\"graphic\"\n                                      .path=${mdiHelp}\n                                    ></ha-svg-icon>\n                                  </mwc-list-item>\n                                </a>\n                              `\n                            : \"\"}\n                        </ha-button-menu>\n                      `\n                    : \"\"}\n                </app-toolbar>\n              `}\n          ${this._editMode\n            ? html`\n                <div sticky>\n                  <paper-tabs\n                    scrollable\n                    .selected=${this._curView}\n                    @iron-activate=${this._handleViewSelected}\n                    dir=${computeRTLDirection(this.hass!)}\n                  >\n                    ${views.map(\n                      (view) => html`\n                        <paper-tab\n                          aria-label=${ifDefined(view.title)}\n                          class=${classMap({\n                            \"hide-tab\": Boolean(\n                              !this._editMode &&\n                                view.visible !== undefined &&\n                                ((Array.isArray(view.visible) &&\n                                  !view.visible.some(\n                                    (e) => e.user === this.hass!.user!.id\n                                  )) ||\n                                  view.visible === false)\n                            ),\n                          })}\n                        >\n                          ${this._editMode\n                            ? html`\n                                <ha-icon-button-arrow-prev\n                                  .hass=${this.hass}\n                                  .label=${this.hass!.localize(\n                                    \"ui.panel.lovelace.editor.edit_view.move_left\"\n                                  )}\n                                  class=\"edit-icon view\"\n                                  @click=${this._moveViewLeft}\n                                  ?disabled=${this._curView === 0}\n                                ></ha-icon-button-arrow-prev>\n                              `\n                            : \"\"}\n                          ${view.icon\n                            ? html`\n                                <ha-icon\n                                  class=${classMap({\n                                    \"child-view-icon\": Boolean(view.subview),\n                                  })}\n                                  title=${ifDefined(view.title)}\n                                  .icon=${view.icon}\n                                ></ha-icon>\n                              `\n                            : view.title || \"Unnamed view\"}\n                          ${this._editMode\n                            ? html`\n                                <ha-svg-icon\n                                  title=${this.hass!.localize(\n                                    \"ui.panel.lovelace.editor.edit_view.edit\"\n                                  )}\n                                  class=\"edit-icon view\"\n                                  .path=${mdiPencil}\n                                  @click=${this._editView}\n                                ></ha-svg-icon>\n                                <ha-icon-button-arrow-next\n                                  .hass=${this.hass}\n                                  .label=${this.hass!.localize(\n                                    \"ui.panel.lovelace.editor.edit_view.move_right\"\n                                  )}\n                                  class=\"edit-icon view\"\n                                  @click=${this._moveViewRight}\n                                  ?disabled=${(this._curView! as number) + 1 ===\n                                  views.length}\n                                ></ha-icon-button-arrow-next>\n                              `\n                            : \"\"}\n                        </paper-tab>\n                      `\n                    )}\n                    ${this._editMode\n                      ? html`\n                          <ha-icon-button\n                            id=\"add-view\"\n                            @click=${this._addView}\n                            .label=${this.hass!.localize(\n                              \"ui.panel.lovelace.editor.edit_view.add\"\n                            )}\n                            .path=${mdiPlus}\n                          ></ha-icon-button>\n                        `\n                      : \"\"}\n                  </paper-tabs>\n                </div>\n              `\n            : \"\"}\n        </app-header>\n        <div id=\"view\" @ll-rebuild=${this._debouncedConfigChanged}></div>\n      </ha-app-layout>\n    `;\n  }\n\n  private _isVisible = (view: LovelaceViewConfig) =>\n    Boolean(\n      this._editMode ||\n        view.visible === undefined ||\n        view.visible === true ||\n        (Array.isArray(view.visible) &&\n          view.visible.some((show) => show.user === this.hass!.user?.id))\n    );\n\n  protected firstUpdated() {\n    // Check for requested edit mode\n    if (extractSearchParam(\"edit\") === \"1\") {\n      this.lovelace!.setEditMode(true);\n    }\n  }\n\n  protected updated(changedProperties: PropertyValues): void {\n    super.updated(changedProperties);\n\n    const view = this._viewRoot;\n    const huiView = view.lastChild as HUIView;\n\n    if (changedProperties.has(\"hass\") && huiView) {\n      huiView.hass = this.hass;\n    }\n\n    if (changedProperties.has(\"narrow\") && huiView) {\n      huiView.narrow = this.narrow;\n    }\n\n    let newSelectView;\n    let force = false;\n\n    let viewPath: string | undefined = this.route!.path.split(\"/\")[1];\n    viewPath = viewPath ? decodeURI(viewPath) : undefined;\n\n    if (changedProperties.has(\"route\")) {\n      const views = this.config.views;\n\n      if (!viewPath && views.length) {\n        newSelectView = views.findIndex(this._isVisible);\n        this._navigateToView(views[newSelectView].path || newSelectView, true);\n      } else if (viewPath === \"hass-unused-entities\") {\n        newSelectView = \"hass-unused-entities\";\n      } else if (viewPath) {\n        const selectedView = viewPath;\n        const selectedViewInt = Number(selectedView);\n        let index = 0;\n        for (let i = 0; i < views.length; i++) {\n          if (views[i].path === selectedView || i === selectedViewInt) {\n            index = i;\n            break;\n          }\n        }\n        newSelectView = index;\n      }\n    }\n\n    if (changedProperties.has(\"lovelace\")) {\n      const oldLovelace = changedProperties.get(\"lovelace\") as\n        | Lovelace\n        | undefined;\n\n      if (!oldLovelace || oldLovelace.config !== this.lovelace!.config) {\n        // On config change, recreate the current view from scratch.\n        force = true;\n      }\n\n      if (!oldLovelace || oldLovelace.editMode !== this.lovelace!.editMode) {\n        const views = this.config && this.config.views;\n\n        fireEvent(this, \"iron-resize\");\n\n        // Leave unused entities when leaving edit mode\n        if (\n          this.lovelace!.mode === \"storage\" &&\n          viewPath === \"hass-unused-entities\"\n        ) {\n          newSelectView = views.findIndex(this._isVisible);\n          this._navigateToView(\n            views[newSelectView].path || newSelectView,\n            true\n          );\n        }\n      }\n\n      if (!force && huiView) {\n        huiView.lovelace = this.lovelace!;\n      }\n    }\n\n    if (newSelectView !== undefined || force) {\n      if (force && newSelectView === undefined) {\n        newSelectView = this._curView;\n      }\n      // Will allow for ripples to start rendering\n      afterNextRender(() => this._selectView(newSelectView, force));\n    }\n  }\n\n  private get config(): LovelaceConfig {\n    return this.lovelace!.config;\n  }\n\n  private get _yamlMode(): boolean {\n    return this.lovelace!.mode === \"yaml\";\n  }\n\n  private get _editMode() {\n    return this.lovelace!.editMode;\n  }\n\n  private get _layout(): any {\n    return this.shadowRoot!.getElementById(\"layout\");\n  }\n\n  private get _viewRoot(): HTMLDivElement {\n    return this.shadowRoot!.getElementById(\"view\") as HTMLDivElement;\n  }\n\n  private get _showButtonMenu(): boolean {\n    return (\n      (this.narrow && this._conversation(this.hass.config.components)) ||\n      this._editMode ||\n      (this.hass!.user?.is_admin && !this.hass!.config.safe_mode) ||\n      (this.hass.panels.lovelace?.config as LovelacePanelConfig)?.mode ===\n        \"yaml\" ||\n      this._yamlMode\n    );\n  }\n\n  private _handleRefresh(ev: CustomEvent<RequestSelectedDetail>): void {\n    if (!shouldHandleRequestSelectedEvent(ev)) {\n      return;\n    }\n    fireEvent(this, \"config-refresh\");\n  }\n\n  private _handleReloadResources(ev: CustomEvent<RequestSelectedDetail>): void {\n    if (!shouldHandleRequestSelectedEvent(ev)) {\n      return;\n    }\n    this.hass.callService(\"lovelace\", \"reload_resources\");\n    showConfirmationDialog(this, {\n      title: this.hass!.localize(\n        \"ui.panel.lovelace.reload_resources.refresh_header\"\n      ),\n      text: this.hass!.localize(\n        \"ui.panel.lovelace.reload_resources.refresh_body\"\n      ),\n      confirmText: this.hass.localize(\"ui.common.refresh\"),\n      dismissText: this.hass.localize(\"ui.common.not_now\"),\n      confirm: () => location.reload(),\n    });\n  }\n\n  private _showQuickBar(): void {\n    showQuickBar(this, {\n      commandMode: false,\n      hint: this.hass.localize(\"ui.tips.key_e_hint\"),\n    });\n  }\n\n  private _goBack(): void {\n    const views = this.lovelace?.config.views ?? [];\n    const curViewConfig =\n      typeof this._curView === \"number\" ? views[this._curView] : undefined;\n\n    if (curViewConfig?.back_path) {\n      navigate(curViewConfig.back_path);\n    } else if (history.length > 0) {\n      history.back();\n    } else {\n      navigate(views[0].path!);\n    }\n  }\n\n  private _handleRawEditor(ev: CustomEvent<RequestSelectedDetail>): void {\n    if (!shouldHandleRequestSelectedEvent(ev)) {\n      return;\n    }\n    this.lovelace!.enableFullEditMode();\n  }\n\n  private _handleManageDashboards(\n    ev: CustomEvent<RequestSelectedDetail>\n  ): void {\n    if (!shouldHandleRequestSelectedEvent(ev)) {\n      return;\n    }\n    navigate(\"/config/lovelace/dashboards\");\n  }\n\n  private _handleManageResources(ev: CustomEvent<RequestSelectedDetail>): void {\n    if (!shouldHandleRequestSelectedEvent(ev)) {\n      return;\n    }\n    navigate(\"/config/lovelace/resources\");\n  }\n\n  private _handleUnusedEntities(ev: CustomEvent<RequestSelectedDetail>): void {\n    if (!shouldHandleRequestSelectedEvent(ev)) {\n      return;\n    }\n    navigate(`${this.route?.prefix}/hass-unused-entities`);\n  }\n\n  private _showVoiceCommandDialog(): void {\n    showVoiceCommandDialog(this);\n  }\n\n  private _handleEnableEditMode(ev: CustomEvent<RequestSelectedDetail>): void {\n    if (!shouldHandleRequestSelectedEvent(ev)) {\n      return;\n    }\n    if (this._yamlMode) {\n      showAlertDialog(this, {\n        text: \"The edit UI is not available when in YAML mode.\",\n      });\n      return;\n    }\n    this.lovelace!.setEditMode(true);\n  }\n\n  private _editModeDisable(): void {\n    this.lovelace!.setEditMode(false);\n  }\n\n  private _editLovelace() {\n    showEditLovelaceDialog(this, this.lovelace!);\n  }\n\n  private _navigateToView(path: string | number, replace?: boolean) {\n    if (!this.lovelace!.editMode) {\n      navigate(`${this.route!.prefix}/${path}${location.search}`, { replace });\n      return;\n    }\n    navigate(`${this.route!.prefix}/${path}?${addSearchParam({ edit: \"1\" })}`, {\n      replace,\n    });\n  }\n\n  private _editView() {\n    showEditViewDialog(this, {\n      lovelace: this.lovelace!,\n      viewIndex: this._curView as number,\n    });\n  }\n\n  private _moveViewLeft(ev) {\n    ev.stopPropagation();\n    if (this._curView === 0) {\n      return;\n    }\n    const lovelace = this.lovelace!;\n    const oldIndex = this._curView as number;\n    const newIndex = (this._curView as number) - 1;\n    this._curView = newIndex;\n    lovelace.saveConfig(swapView(lovelace.config, oldIndex, newIndex));\n  }\n\n  private _moveViewRight(ev) {\n    ev.stopPropagation();\n    if ((this._curView! as number) + 1 === this.lovelace!.config.views.length) {\n      return;\n    }\n    const lovelace = this.lovelace!;\n    const oldIndex = this._curView as number;\n    const newIndex = (this._curView as number) + 1;\n    this._curView = newIndex;\n    lovelace.saveConfig(swapView(lovelace.config, oldIndex, newIndex));\n  }\n\n  private _addView() {\n    showEditViewDialog(this, {\n      lovelace: this.lovelace!,\n      saveCallback: (viewIndex: number, viewConfig: LovelaceViewConfig) => {\n        const path = viewConfig.path || viewIndex;\n        this._navigateToView(path);\n      },\n    });\n  }\n\n  private _handleViewSelected(ev) {\n    const viewIndex = ev.detail.selected as number;\n\n    if (viewIndex !== this._curView) {\n      const path = this.config.views[viewIndex].path || viewIndex;\n      this._navigateToView(path);\n    }\n    scrollToTarget(this, this._layout.header.scrollTarget);\n  }\n\n  private _selectView(viewIndex: HUIRoot[\"_curView\"], force: boolean): void {\n    if (!force && this._curView === viewIndex) {\n      return;\n    }\n\n    viewIndex = viewIndex === undefined ? 0 : viewIndex;\n\n    this._curView = viewIndex;\n\n    if (force) {\n      this._viewCache = {};\n    }\n\n    // Recreate a new element to clear the applied themes.\n    const root = this._viewRoot;\n\n    if (root.lastChild) {\n      root.removeChild(root.lastChild);\n    }\n\n    if (viewIndex === \"hass-unused-entities\") {\n      const unusedEntities = document.createElement(\"hui-unused-entities\");\n      // Wait for promise to resolve so that the element has been upgraded.\n      import(\"./editor/unused-entities/hui-unused-entities\").then(() => {\n        unusedEntities.hass = this.hass!;\n        unusedEntities.lovelace = this.lovelace!;\n        unusedEntities.narrow = this.narrow;\n      });\n      root.appendChild(unusedEntities);\n      return;\n    }\n\n    let view;\n    const viewConfig = this.config.views[viewIndex];\n\n    if (!viewConfig) {\n      this.lovelace!.setEditMode(true);\n      return;\n    }\n\n    if (!force && this._viewCache![viewIndex]) {\n      view = this._viewCache![viewIndex];\n    } else {\n      view = document.createElement(\"hui-view\");\n      view.index = viewIndex;\n      this._viewCache![viewIndex] = view;\n    }\n\n    view.lovelace = this.lovelace;\n    view.hass = this.hass;\n    view.narrow = this.narrow;\n\n    const configBackground = viewConfig.background || this.config.background;\n\n    if (configBackground) {\n      this._appLayout.style.setProperty(\n        \"--lovelace-background\",\n        configBackground\n      );\n    } else {\n      this._appLayout.style.removeProperty(\"--lovelace-background\");\n    }\n\n    root.appendChild(view);\n    // Recalculate to see if we need to adjust content area for tab bar\n    fireEvent(this, \"iron-resize\");\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        :host {\n          -ms-user-select: none;\n          -webkit-user-select: none;\n          -moz-user-select: none;\n        }\n\n        ha-app-layout {\n          min-height: 100%;\n        }\n        ha-tabs {\n          width: 100%;\n          height: 100%;\n          margin-left: 4px;\n        }\n        paper-tabs {\n          margin-left: 12px;\n          margin-left: max(env(safe-area-inset-left), 12px);\n          margin-right: env(safe-area-inset-right);\n        }\n        ha-tabs,\n        paper-tabs {\n          --paper-tabs-selection-bar-color: var(\n            --app-header-selection-bar-color,\n            var(--app-header-text-color, #fff)\n          );\n          text-transform: uppercase;\n        }\n\n        .edit-mode app-header,\n        .edit-mode app-toolbar {\n          background-color: var(--app-header-edit-background-color, #455a64);\n          color: var(--app-header-edit-text-color, #fff);\n        }\n        .edit-mode div[main-title] {\n          pointer-events: auto;\n        }\n        paper-tab.iron-selected .edit-icon {\n          display: inline-flex;\n        }\n        .edit-icon {\n          color: var(--accent-color);\n          padding-left: 8px;\n          padding-inline-start: 8px;\n          vertical-align: middle;\n          --mdc-theme-text-disabled-on-light: var(--disabled-text-color);\n          direction: var(--direction);\n        }\n        .edit-icon.view {\n          display: none;\n        }\n        #add-view {\n          position: absolute;\n          height: 44px;\n        }\n        #add-view ha-svg-icon {\n          background-color: var(--accent-color);\n          border-radius: 4px;\n        }\n        app-toolbar a {\n          color: var(--text-primary-color, white);\n        }\n        mwc-button.warning:not([disabled]) {\n          color: var(--error-color);\n        }\n        #view {\n          min-height: calc(100vh - var(--header-height));\n          /**\n          * Since we only set min-height, if child nodes need percentage\n          * heights they must use absolute positioning so we need relative\n          * positioning here.\n          *\n          * https://www.w3.org/TR/CSS2/visudet.html#the-height-property\n          */\n          position: relative;\n          display: flex;\n        }\n        /**\n         * In edit mode we have the tab bar on a new line *\n         */\n        .edit-mode #view {\n          min-height: calc(100vh - var(--header-height) - 48px);\n        }\n        #view > * {\n          /**\n          * The view could get larger than the window in Firefox\n          * to prevent that we set the max-width to 100%\n          * flex-grow: 1 and flex-basis: 100% should make sure the view\n          * stays full width.\n          *\n          * https://github.com/home-assistant/home-assistant-polymer/pull/3806\n          */\n          flex: 1 1 100%;\n          max-width: 100%;\n        }\n        .hide-tab {\n          display: none;\n        }\n        .menu-link {\n          text-decoration: none;\n        }\n        hui-view {\n          background: var(\n            --lovelace-background,\n            var(--primary-background-color)\n          );\n        }\n        .exit-edit-mode {\n          --mdc-theme-primary: var(--app-header-edit-text-color, #fff);\n          --mdc-button-outline-color: var(--app-header-edit-text-color, #fff);\n          --mdc-typography-button-font-size: 14px;\n        }\n        .child-view-icon {\n          opacity: 0.5;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-root\": HUIRoot;\n  }\n}\n\ncustomElements.define(\"hui-root\", HUIRoot);\n"],"names":[],"sourceRoot":""}